@page "/shop/{id:guid}"
@using BlindBoxShop.Shared.DataTransferObject.Shop
@using BlindBoxShop.Shared.Enum

<!-- Page Header -->
<MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="mt-0 px-0">
    <MudPaper Elevation="0" Class="page-header" Style="background-color: var(--mud-palette-secondary);">
        <MudText Typo="Typo.h3" Class="font-weight-bold mb-2">Product Details</MudText>
        <MudText Typo="Typo.body1">Explore the complete details of this product</MudText>
    </MudPaper>
</MudContainer>

<MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="px-4 mt-4">
    <MudBreadcrumbs Items="_breadcrumbs" Separator="/" Class="mb-4"></MudBreadcrumbs>

    <MudGrid>
        <!-- Product Images Section -->
        <MudItem xs="12" md="5">
            <MudPaper Elevation="0" Class="mb-4">
                <div class="d-flex flex-column" style="height: 400px;">
                    <img src="@_product?.ImageUrl" alt="@_product?.Name" class="rounded-lg object-fit-cover" style="width: 100%; height: 400px; object-fit: contain;" />
                </div>
            </MudPaper>
            
            <MudGrid Class="mt-2" Spacing="1">
                @foreach (var thumbnail in _thumbnails)
                {
                    <MudItem xs="3">
                        <MudPaper Class="@($"pa-1 {(thumbnail == _selectedThumbnail ? "mud-border-primary border-2" : "")}")" 
                                  Style="height: 80px; cursor: pointer;"
                                  @onclick="() => SelectThumbnail(thumbnail)">
                            <img src="@thumbnail" alt="Thumbnail" style="width: 100%; height: 100%; object-fit: cover;" class="rounded" />
                        </MudPaper>
                    </MudItem>
                }
            </MudGrid>
        </MudItem>

        <!-- Product Info Section -->
        <MudItem xs="12" md="7">
            <MudPaper Elevation="0" Class="pa-4">
                <MudText Typo="Typo.h4" Class="mb-2">@_product?.Name</MudText>
                
                <MudText Typo="Typo.caption" Color="Color.Secondary" Class="mb-2">Brand: @_product?.Brand</MudText>
                
                <div class="d-flex align-center my-3">
                    <MudRating ReadOnly="true" SelectedValue="@(_product?.Rating ?? 0)" T="int" />
                    <MudText Typo="Typo.caption" Class="ml-2">@_product?.ReviewCount ratings</MudText>
                </div>
                
                <div class="d-flex align-center">
                    <MudText Typo="Typo.h5" Color="Color.Primary" Class="font-weight-bold">@FormatPrice(_product?.DiscountPrice ?? 0)</MudText>
                    @if (_product?.DiscountPrice < _product?.OriginalPrice)
                    {
                        <MudText Typo="Typo.body1" Color="Color.Secondary" Class="ml-4" Style="text-decoration: line-through; text-decoration-thickness: 2px;">@FormatPrice(_product?.OriginalPrice ?? 0)</MudText>
                    }
                </div>
                
                <MudDivider Class="my-4" />
                
                <MudText Typo="Typo.body1" Class="mb-4">@_product?.Description</MudText>
                
                <MudText Typo="Typo.subtitle1" Class="mt-4 mb-2">In Stock: @_product?.StockQuantity</MudText>
                
                <div class="d-flex align-center mt-4">
                    <MudNumericField @bind-Value="_quantity" Min="1" Max="@(_product?.StockQuantity ?? 10)" Class="mr-4" Style="width: 120px" T="int" />
                    <MudButton Variant="Variant.Filled" Color="Color.Primary" Size="Size.Large" 
                              FullWidth="false" Class="px-8" 
                              OnClick="AddToCart"
                              StartIcon="@Icons.Material.Filled.ShoppingCart">
                        Add to cart
                    </MudButton>
                    <MudIconButton Icon="@Icons.Material.Filled.FavoriteBorder" Color="Color.Primary" Class="ml-2" />
                </div>
            </MudPaper>
        </MudItem>
    </MudGrid>
    
    <!-- Product Details Section -->
    <MudCard Elevation="2" Class="mt-8">
        <MudCardHeader>
            <MudText Typo="Typo.h5">Product details</MudText>
        </MudCardHeader>
        <MudCardContent>
            <MudGrid>
                <MudItem xs="12" md="6">
                    <MudList T="string" Dense="false" DisablePadding="false">
                        <MudListItem T="string">
                            <div class="d-flex">
                                <MudText Typo="Typo.body1" Class="mr-2 font-weight-bold">Manufacturer:</MudText>
                                <MudText Typo="Typo.body1">@_product?.Brand</MudText>
                            </div>
                        </MudListItem>
                        <MudListItem T="string">
                            <div class="d-flex">
                                <MudText Typo="Typo.body1" Class="mr-2 font-weight-bold">Product Dimensions:</MudText>
                                <MudText Typo="Typo.body1">@_product?.Dimensions</MudText>
                            </div>
                        </MudListItem>
                        <MudListItem T="string">
                            <div class="d-flex">
                                <MudText Typo="Typo.body1" Class="mr-2 font-weight-bold">Item model number:</MudText>
                                <MudText Typo="Typo.body1">@_product?.ModelNumber</MudText>
                            </div>
                        </MudListItem>
                    </MudList>
                </MudItem>
                <MudItem xs="12" md="6">
                    <MudList T="string" Dense="false" DisablePadding="false">
                        <MudListItem T="string">
                            <div class="d-flex">
                                <MudText Typo="Typo.body1" Class="mr-2 font-weight-bold">Date First Available:</MudText>
                                <MudText Typo="Typo.body1">@_product?.ReleaseDate?.ToString("MMM yyyy")</MudText>
                            </div>
                        </MudListItem>
                        <MudListItem T="string">
                            <div class="d-flex">
                                <MudText Typo="Typo.body1" Class="mr-2 font-weight-bold">Country of Origin:</MudText>
                                <MudText Typo="Typo.body1">@_product?.CountryOrigin</MudText>
                            </div>
                        </MudListItem>
                        <MudListItem T="string">
                            <div class="d-flex">
                                <MudText Typo="Typo.body1" Class="mr-2 font-weight-bold">Best Sellers Rank:</MudText>
                                <MudText Typo="Typo.body1">@_product?.BestSellersRank</MudText>
                            </div>
                        </MudListItem>
                    </MudList>
                </MudItem>
            </MudGrid>
        </MudCardContent>
    </MudCard>
    
    <!-- Customer Reviews Section -->
    <MudCard Elevation="2" Class="mt-6 mb-6">
        <MudCardHeader>
            <MudGrid>
                <MudItem xs="12" md="6">
                    <MudText Typo="Typo.h5">Customer reviews</MudText>
                    <div class="d-flex align-center mt-2">
                        <MudRating ReadOnly="true" SelectedValue="@(_product?.Rating ?? 0)" Size="Size.Large" />
                        <MudText Typo="Typo.body1" Class="ml-2">@(_product?.Rating ?? 0) out of 5</MudText>
                    </div>
                    <MudText Typo="Typo.body2" Color="Color.Secondary" Class="mt-1">@_product?.ReviewCount global ratings</MudText>
                </MudItem>
                <MudItem xs="12" md="6">
                    <MudList T="string" Dense="true" DisableGutters="true" Class="pa-0">
                        <MudListItem T="string">
                            <div class="d-flex align-center">
                                <MudText Typo="Typo.body2" Class="mr-2">5 star</MudText>
                                <MudProgressLinear Color="Color.Success" Value="67" Class="flex-grow-1 mx-4" />
                                <MudText Typo="Typo.body2">67%</MudText>
                            </div>
                        </MudListItem>
                        <MudListItem T="string">
                            <div class="d-flex align-center">
                                <MudText Typo="Typo.body2" Class="mr-2">4 star</MudText>
                                <MudProgressLinear Color="Color.Info" Value="22" Class="flex-grow-1 mx-4" />
                                <MudText Typo="Typo.body2">22%</MudText>
                            </div>
                        </MudListItem>
                        <MudListItem T="string">
                            <div class="d-flex align-center">
                                <MudText Typo="Typo.body2" Class="mr-2">3 star</MudText>
                                <MudProgressLinear Color="Color.Warning" Value="7" Class="flex-grow-1 mx-4" />
                                <MudText Typo="Typo.body2">7%</MudText>
                            </div>
                        </MudListItem>
                        <MudListItem T="string">
                            <div class="d-flex align-center">
                                <MudText Typo="Typo.body2" Class="mr-2">2 star</MudText>
                                <MudProgressLinear Color="Color.Warning" Value="2" Class="flex-grow-1 mx-4" />
                                <MudText Typo="Typo.body2">2%</MudText>
                            </div>
                        </MudListItem>
                        <MudListItem T="string">
                            <div class="d-flex align-center">
                                <MudText Typo="Typo.body2" Class="mr-2">1 star</MudText>
                                <MudProgressLinear Color="Color.Error" Value="2" Class="flex-grow-1 mx-4" />
                                <MudText Typo="Typo.body2">2%</MudText>
                            </div>
                        </MudListItem>
                    </MudList>
                </MudItem>
            </MudGrid>
        </MudCardHeader>
        <MudCardContent>
            <MudText Typo="Typo.h6" Class="mb-4">Reviews with images</MudText>
            <div class="d-flex overflow-x-auto pb-4">
                @foreach (var review in _reviewsWithImages)
                {
                    <MudPaper Class="pa-2 mr-3" Style="min-width: 150px;">
                        <img src="@review.ImageUrl" alt="Review image" style="width: 150px; height: 150px; object-fit: cover;" />
                    </MudPaper>
                }
            </div>
            
            <MudDivider Class="my-4" />
            
            @foreach (var review in _reviews)
            {
                <MudPaper Elevation="0" Class="mb-6 py-2">
                    <div class="d-flex align-center mb-2">
                        <MudAvatar Image="@review.AvatarUrl" Size="Size.Medium" Class="mr-2" />
                        <div>
                            <MudText Typo="Typo.subtitle1">@review.CustomerName</MudText>
                        </div>
                    </div>
                    <div class="d-flex align-center mb-2">
                        <MudRating ReadOnly="true" SelectedValue="@review.Rating" />
                        <MudText Typo="Typo.body2" Class="ml-2 font-weight-bold">@review.Title</MudText>
                    </div>
                    <MudText Typo="Typo.caption" Color="Color.Secondary" Class="mb-2">
                        Reviewed on @review.ReviewDate.ToString("MMMM dd, yyyy")
                    </MudText>
                    <MudText Typo="Typo.body2" Class="mb-2">
                        @review.Comment
                    </MudText>
                </MudPaper>
            }
        </MudCardContent>
    </MudCard>
</MudContainer> 