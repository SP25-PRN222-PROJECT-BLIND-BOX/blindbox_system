@page "/shop"
@using BlindBoxShop.Service.Contract
@using BlindBoxShop.Shared.Enum
@using BlindBoxShop.Shared.DataTransferObject.Shop

<PageTitle>BlindBox Shop - Products</PageTitle>

<!-- Page Header -->
<MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="mt-0 px-0">
    <MudPaper Elevation="0" Class="page-header" Style="background-color: var(--mud-palette-secondary);">
        <MudText Typo="Typo.h3" Class="font-weight-bold mb-2">BoxBox Products</MudText>
        <MudText Typo="Typo.body1">Put description here.</MudText>
    </MudPaper>
</MudContainer>

<!-- Main Content -->
<MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="mt-4">
    <MudGrid>
        <!-- Categories Sidebar -->
        <MudItem xs="12" sm="3" md="2">
            <MudPaper Class="pa-4" Elevation="1">
                <div class="d-flex align-center mb-4">
                    <MudIcon Icon="@Icons.Material.Filled.Category" Size="Size.Small" Class="mr-2" />
                    <MudText Typo="Typo.h6" Class="mb-0">Categories</MudText>
                </div>
                
                @foreach (var category in _categories)
                {
                    string buttonClass = "d-block px-2 py-1 mb-1 rounded";
                    if (category.Id == _selectedCategoryId)
                    {
                        buttonClass += " mud-theme-primary";
                    }
                    
                    <MudButton Variant="Variant.Text" Color="Color.Primary" 
                              Class="@buttonClass" 
                              OnClick="@(() => SelectCategory(category.Id))">
                        @category.Name
                    </MudButton>
                }
            </MudPaper>
        </MudItem>
        
        <!-- Product Grid -->
        <MudItem xs="12" sm="9" md="10">
            <MudGrid Spacing="2">
                @foreach (var product in _products)
                {
                    <MudItem xs="12" sm="6" md="6" lg="3">
                        <MudPaper Elevation="2" Class="h-100" Style="display: flex; flex-direction: column; height: 380px;">
                            <div style="height: 200px; overflow: hidden; position: relative; cursor: pointer;" @onclick="@(() => NavigateToProductDetail(product.Id))">
                                <img src="@product.ImageUrl" alt="@product.Name" style="width: 100%; height: 100%; object-fit: cover;" />
                            </div>
                            <div class="pa-4 d-flex flex-column flex-grow-1">
                                <MudText Typo="Typo.h6" Style="height: 50px; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; cursor: pointer;" @onclick="@(() => NavigateToProductDetail(product.Id))">@product.Name</MudText>
                                <div class="my-2">
                                    <MudRating ReadOnly="true" SelectedValue="@product.Rating" />
                                </div>
                                <MudSpacer />
                                <MudText Typo="Typo.h6" Color="Color.Primary" Class="font-weight-bold mt-2">@FormatPrice(product.Price)</MudText>
                                <div class="d-flex mt-2">
                                    <MudButton Variant="Variant.Text" 
                                               StartIcon="@Icons.Material.Filled.Visibility" 
                                               Size="Size.Small"
                                               Href="@($"/shop/{product.Id}")"
                                               Class="flex-grow-0 px-1">Details</MudButton>
                                    <MudSpacer />
                                    <MudButton Variant="Variant.Filled" 
                                               Color="Color.Primary" 
                                               StartIcon="@Icons.Material.Filled.ShoppingCart" 
                                               Size="Size.Small">Add to Cart</MudButton>
                                </div>
                            </div>
                        </MudPaper>
                    </MudItem>
                }
            </MudGrid>
            
            <!-- Pagination -->
            <MudPaper Elevation="0" Class="pa-2 d-flex justify-center mt-6">
                <div class="d-flex align-center">
                    <MudButton Variant="Variant.Text" 
                              OnClick="@(() => PreviousPage())" 
                              Disabled="@(_currentPage == 1)"
                              Class="mx-1">
                        <MudIcon Icon="@Icons.Material.Filled.ChevronLeft" />
                    </MudButton>
                    
                    @for (int i = 1; i <= Math.Min(4, _totalPages); i++)
                    {
                        var pageNumber = i;
                        <MudButton Variant="@(_currentPage == pageNumber ? Variant.Filled : Variant.Outlined)" 
                                  Color="Color.Primary" 
                                  OnClick="@(() => PageChanged(pageNumber))"
                                  Class="mx-1" 
                                  Style="min-width: 40px;">
                            @pageNumber
                        </MudButton>
                    }
                    
                    <MudButton Variant="Variant.Text" 
                              OnClick="@(() => NextPage())" 
                              Disabled="@(_currentPage >= _totalPages)"
                              Class="mx-1">
                        <MudIcon Icon="@Icons.Material.Filled.ChevronRight" />
                    </MudButton>
                </div>
            </MudPaper>
        </MudItem>
    </MudGrid>
</MudContainer>

<!-- Footer -->
<MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="mt-16 mb-8">
    <MudPaper Elevation="0" Class="py-8 px-4" Style="background-color: var(--mud-palette-primary); color: white;">
        <MudGrid>
            <MudItem xs="12" sm="6" md="3">
                <MudText Typo="Typo.h5" Class="mb-4">BoxBox</MudText>
                <MudText Typo="Typo.body2" Class="mb-4">Slogan should be here.</MudText>
                <div class="d-flex">
                    <MudIconButton Icon="@Icons.Custom.Brands.Facebook" Color="Color.Inherit" Class="mr-2" />
                    <MudIconButton Icon="@Icons.Custom.Brands.Twitter" Color="Color.Inherit" Class="mr-2" />
                    <MudIconButton Icon="@Icons.Custom.Brands.Instagram" Color="Color.Inherit" Class="mr-2" />
                    <MudIconButton Icon="@Icons.Custom.Brands.LinkedIn" Color="Color.Inherit" Class="mr-2" />
                    <MudIconButton Icon="@Icons.Custom.Brands.YouTube" Color="Color.Inherit" />
                </div>
            </MudItem>
            
            <MudItem xs="12" sm="6" md="3">
                <MudText Typo="Typo.h6" Class="mb-4">Product</MudText>
                <MudText Typo="Typo.body2" Class="mb-2">Features</MudText>
                <MudText Typo="Typo.body2" Class="mb-2">Pricing</MudText>
                <MudText Typo="Typo.body2" Class="mb-2">Case studies</MudText>
                <MudText Typo="Typo.body2" Class="mb-2">Reviews</MudText>
                <MudText Typo="Typo.body2" Class="mb-2">Updates</MudText>
            </MudItem>
            
            <MudItem xs="12" sm="6" md="3">
                <MudText Typo="Typo.h6" Class="mb-4">Company</MudText>
                <MudText Typo="Typo.body2" Class="mb-2">About</MudText>
                <MudText Typo="Typo.body2" Class="mb-2">Contact us</MudText>
                <MudText Typo="Typo.body2" Class="mb-2">Careers</MudText>
                <MudText Typo="Typo.body2" Class="mb-2">Culture</MudText>
                <MudText Typo="Typo.body2" Class="mb-2">Blog</MudText>
            </MudItem>
            
            <MudItem xs="12" sm="6" md="3">
                <MudText Typo="Typo.h6" Class="mb-4">Support</MudText>
                <MudText Typo="Typo.body2" Class="mb-2">Getting started</MudText>
                <MudText Typo="Typo.body2" Class="mb-2">Help center</MudText>
                <MudText Typo="Typo.body2" Class="mb-2">Server status</MudText>
                <MudText Typo="Typo.body2" Class="mb-2">Report a bug</MudText>
                <MudText Typo="Typo.body2" Class="mb-2">Chat support</MudText>
            </MudItem>
        </MudGrid>
        
        <MudDivider Class="my-6" />
        
        <MudText Typo="Typo.body2" Align="Align.Center">
            Copyright Â© 2023 BoxBox Templates | All Rights Reserved | Terms and Conditions | Privacy Policy
        </MudText>
    </MudPaper>
</MudContainer>